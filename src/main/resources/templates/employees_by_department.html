<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Employees by Department</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
</head>
<body class="bg-light">

<div class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="mb-0">Filter Employees</h1>
            <p class="text-muted">Data Handled by Vanshika</p>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header">Select a Department</div>
        <div class="card-body">
            <form th:action="@{/employees-by-department}" method="get" class="d-flex align-items-center">
                <select id="department-select" name="departmentName" class="form-control me-2">
                    <option value="">-- Choose Department --</option>
                    <option th:each="dept : ${departments}"
                            th:value="${dept.departmentName}"
                            th:text="${dept.departmentName}"
                            th:selected="${dept.departmentName == selectedDepartmentName}"></option>
                </select>
                <button type="submit" class="btn btn-primary">Search</button>
            </form>
        </div>
    </div>

    <div th:if="${employeePage != null}">
        <div class="card">
            <div class="card-header d-flex justify-content-between">
                <h5 class="mb-0">Employees in <span class="text-primary" th:text="${selectedDepartmentName}"></span></h5>
                <span class="text-muted" th:text="|Showing ${employeePage.numberOfElements} of ${employeePage.totalElements} records|"></span>
            </div>
            <div class="card-body">
                <div class="table-responsive" th:if="${!employeePage.empty}">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                        <tr>
                            <th><a class="text-white" th:href="@{/employees-by-department(size=${employeePage.size}, departmentName=${selectedDepartmentName}, sortBy='employeeId', sortDir=${reverseSortDir})}">ID <i th:if="${sortBy == 'employeeId'}" th:class="${sortDir == 'asc' ? 'bi bi-arrow-up' : 'bi bi-arrow-down'}"></i></a></th>
                            <th><a class="text-white" th:href="@{/employees-by-department(size=${employeePage.size}, departmentName=${selectedDepartmentName}, sortBy='firstName', sortDir=${reverseSortDir})}">First Name <i th:if="${sortBy == 'firstName'}" th:class="${sortDir == 'asc' ? 'bi bi-arrow-up' : 'bi bi-arrow-down'}"></i></a></th>
                            <th><a class="text-white" th:href="@{/employees-by-department(size=${employeePage.size}, departmentName=${selectedDepartmentName}, sortBy='lastName', sortDir=${reverseSortDir})}">Last Name <i th:if="${sortBy == 'lastName'}" th:class="${sortDir == 'asc' ? 'bi bi-arrow-up' : 'bi bi-arrow-down'}"></i></a></th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="emp : ${employeePage.content}">
                            <td th:text="${emp.employeeId}"></td>
                            <td th:text="${emp.firstName}"></td>
                            <td th:text="${emp.lastName}"></td>
                            <td th:text="${emp.email}"></td>
                            <td th:text="${emp.phoneNumber}"></td>
                            <td><a th:href="@{/employees/{id}/edit-department(id=${emp.employeeId}, fromDept=${selectedDepartmentName})}" class="btn btn-sm btn-outline-secondary"><i class="bi bi-pencil"></i> Edit</a></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div th:if="${employeePage.empty}" class="text-center p-4">
                    <p class="text-muted">No employees found for this department.</p>
                </div>
            </div>
            <div class="card-footer" th:if="${employeePage.totalPages > 1}">
                <nav aria-label="Pagination">
                    <ul class="pagination justify-content-center mb-0">
                        <li class="page-item" th:classappend="${employeePage.first ? 'disabled' : ''}">
                            <a class="page-link" th:href="@{/employees-by-department(size=${employeePage.size}, departmentName=${selectedDepartmentName}, page=${employeePage.number - 1}, sortBy=${sortBy}, sortDir=${sortDir})}">Previous</a>
                        </li>
                        <li class="page-item" th:each="pageNumber : ${#numbers.sequence(0, employeePage.totalPages - 1)}" th:classappend="${pageNumber == employeePage.number ? 'active' : ''}">
                            <a class="page-link" th:href="@{/employees-by-department(size=${employeePage.size}, departmentName=${selectedDepartmentName}, page=${pageNumber}, sortBy=${sortBy}, sortDir=${sortDir})}" th:text="${pageNumber + 1}"></a>
                        </li>
                        <li class="page-item" th:classappend="${employeePage.last ? 'disabled' : ''}">
                            <a class="page-link" th:href="@{/employees-by-department(size=${employeePage.size}, departmentName=${selectedDepartmentName}, page=${employeePage.number + 1}, sortBy=${sortBy}, sortDir=${sortDir})}">Next</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>

    <a th:href="@{/}" class="btn btn-link mt-3">&larr; Back to Home</a>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        new Choices('#department-select', { searchEnabled: true, itemSelectText: 'Press to select' });
    });
</script>

</body>
</html>
